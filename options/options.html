<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PromptBoost Settings</title>
    <link rel="stylesheet" href="options.css" />
  </head>
  <body>
    <div class="container">
      <header>
        <div class="header-content">
          <div class="header-left">
            <button id="sidebarToggle" class="sidebar-toggle" aria-label="Toggle sidebar">
              <span class="hamburger-line"></span>
              <span class="hamburger-line"></span>
              <span class="hamburger-line"></span>
            </button>
            <h1>PromptBoost Dashboard</h1>
            <p>AI-powered text optimization settings</p>
          </div>
          <div class="header-right">
            <div class="search-container">
              <input type="text" id="globalSearch" placeholder="Search settings..." class="search-input">
              <span class="search-icon">üîç</span>
            </div>
            <div class="status-badge">
              <div class="status-dot"></div>
              <span id="headerStatus">Ready</span>
            </div>
          </div>
        </div>
      </header>

      <div class="layout-container">
        <!-- Sidebar Navigation -->
        <aside id="sidebar" class="sidebar">
          <nav class="sidebar-nav">
            <div class="nav-section">
              <h3 class="nav-section-title">Dashboard</h3>
              <ul class="nav-list">
                <li><a href="#overview" class="nav-link active" data-section="overview">
                  <span class="nav-icon">üìä</span>
                  <span class="nav-text">Overview</span>
                </a></li>
              </ul>
            </div>

            <div class="nav-section">
              <h3 class="nav-section-title">Settings</h3>
              <ul class="nav-list">
                <li><a href="#general" class="nav-link" data-section="general">
                  <span class="nav-icon">‚öôÔ∏è</span>
                  <span class="nav-text">General</span>
                </a></li>
                <li><a href="#provider" class="nav-link" data-section="provider">
                  <span class="nav-icon">ü§ñ</span>
                  <span class="nav-text">AI Provider</span>
                </a></li>
                <li><a href="#templates" class="nav-link" data-section="templates">
                  <span class="nav-icon">üìù</span>
                  <span class="nav-text">Templates</span>
                </a></li>
                <li><a href="#advanced" class="nav-link" data-section="advanced">
                  <span class="nav-icon">üîß</span>
                  <span class="nav-text">Advanced</span>
                </a></li>
              </ul>
            </div>

            <div class="nav-section">
              <h3 class="nav-section-title">Data</h3>
              <ul class="nav-list">
                <li><a href="#history" class="nav-link" data-section="history">
                  <span class="nav-icon">üìà</span>
                  <span class="nav-text">History</span>
                </a></li>
                <li><a href="#backup" class="nav-link" data-section="backup">
                  <span class="nav-icon">üíæ</span>
                  <span class="nav-text">Backup</span>
                </a></li>
              </ul>
            </div>

            <div class="nav-section">
              <h3 class="nav-section-title">Help</h3>
              <ul class="nav-list">
                <li><a href="#tour" class="nav-link" data-action="start-tour">
                  <span class="nav-icon">üéØ</span>
                  <span class="nav-text">Take Tour</span>
                </a></li>
              </ul>
            </div>
          </nav>
        </aside>

        <!-- Main Content Area -->
        <main id="mainContent" class="main-content">
          <div class="main-content-inner">
            <!-- Breadcrumb Navigation -->
            <nav class="breadcrumb" id="breadcrumb">
            <ol class="breadcrumb-list">
              <li class="breadcrumb-item"><a href="#overview">Dashboard</a></li>
              <li class="breadcrumb-item active">Overview</li>
            </ol>
          </nav>

          <!-- Content Sections -->
          <div class="content-section active" id="overview-section">
            <div class="section-header">
              <h2>Dashboard Overview</h2>
              <p>Monitor your PromptBoost usage and quick access to common actions</p>
            </div>

            <!-- Dashboard Overview -->
            <div class="dashboard-grid">
              <div class="dashboard-card">
                <h3>Quick Stats</h3>
                <div class="stats-grid">
                  <div class="stat-item">
                    <div class="stat-value" id="dashTotalOptimizations">0</div>
                    <div class="stat-label">Total Optimizations</div>
                  </div>
                  <div class="stat-item">
                    <div class="stat-value" id="dashActiveTemplates">8</div>
                    <div class="stat-label">Active Templates</div>
                  </div>
                </div>
              </div>

              <div class="dashboard-card">
                <h3>Quick Actions</h3>
                <div class="quick-actions">
                  <button type="button" id="dashTestApi" class="btn-outline">Test API</button>
                  <button type="button" id="dashViewHistory" class="btn-outline">View History</button>
                  <button type="button" id="dashCreateTemplate" class="btn-primary">New Template</button>
                </div>
              </div>
            </div>
          </div>

          <!-- General Settings Section -->
          <div class="content-section" id="general-section">
            <div class="section-header">
              <h2>General Settings</h2>
              <p>Configure basic extension behavior and activation methods</p>
            </div>

            <section class="settings-section">
              <h3>Extension Control</h3>
              <div class="setting-item">
                <label class="toggle-label">
                  <input type="checkbox" id="enabled" checked />
                  <span class="toggle-slider"></span>
                  Enable PromptBoost
                </label>
                <p class="setting-description">Turn the extension on or off</p>
              </div>
            </section>

            <section class="settings-section">
              <h3>Activation Settings</h3>
              <div class="setting-item">
                <label for="timeWindow">Triple-space detection window (ms):</label>
                <input
                  type="number"
                  id="timeWindow"
                  min="500"
                  max="3000"
                  value="1000"
                />
                <p class="setting-description">
                  Time window for detecting three consecutive spacebar presses
                </p>
              </div>

              <div class="setting-item">
                <label for="keyboardShortcut">Keyboard shortcut:</label>
                <input
                  type="text"
                  id="keyboardShortcut"
                  value="Ctrl+Shift+Space"
                  readonly
                />
                <p class="setting-description">
                  Alternative keyboard shortcut to trigger optimization
                </p>
              </div>
            </section>
          </div>

          <!-- Advanced Settings Section -->
          <div class="content-section" id="advanced-section">
            <div class="section-header">
              <h2>Advanced Settings</h2>
              <p>Configure advanced features, debugging, and performance options</p>
            </div>

            <section class="settings-section">
              <h3>Debugging & Logging</h3>
              <div class="setting-item">
                <label class="toggle-label">
                  <input type="checkbox" id="enableLogging" checked>
                  <span class="toggle-slider"></span>
                  Enable debug logging
                </label>
                <p class="setting-description">Log debug information to browser console</p>
              </div>
            </section>

            <section class="settings-section">
              <h3>History Management</h3>
              <div class="setting-item">
                <label class="toggle-label">
                  <input type="checkbox" id="autoSaveHistory" checked>
                  <span class="toggle-slider"></span>
                  Auto-save optimization history
                </label>
                <p class="setting-description">Automatically save optimization history for review</p>
              </div>

              <div class="setting-item">
                <label for="maxHistoryItems">Maximum history items:</label>
                <input type="number" id="maxHistoryItems" min="10" max="1000" value="100">
                <p class="setting-description">Maximum number of history items to keep (10-1000)</p>
              </div>
            </section>

            <section class="settings-section">
              <h3>Performance & Reliability</h3>
              <div class="setting-item">
                <label for="requestTimeout">API request timeout (seconds):</label>
                <input type="number" id="requestTimeout" min="5" max="120" value="30">
                <p class="setting-description">Timeout for API requests in seconds (5-120)</p>
              </div>

              <div class="setting-item">
                <label for="retryAttempts">Retry attempts:</label>
                <input type="number" id="retryAttempts" min="0" max="5" value="3">
                <p class="setting-description">Number of retry attempts for failed API calls (0-5)</p>
              </div>
            </section>

            <section class="settings-section">
              <h3>Notifications</h3>
              <div class="setting-item">
                <label class="toggle-label">
                  <input type="checkbox" id="showNotifications" checked>
                  <span class="toggle-slider"></span>
                  Show notifications
                </label>
                <p class="setting-description">Display success/error notifications</p>
              </div>

              <div class="setting-item">
                <label for="notificationDuration">Notification duration (seconds):</label>
                <input type="number" id="notificationDuration" min="1" max="10" value="4">
                <p class="setting-description">How long to show notifications (1-10 seconds)</p>
              </div>
            </section>
          </div>

          <!-- AI Provider Settings Section -->
          <div class="content-section" id="provider-section">
            <div class="section-header">
              <h2>AI Provider Settings</h2>
              <p>Configure your AI provider, authentication, and model preferences</p>
            </div>

            <section class="settings-section">
              <h3>Provider Selection</h3>
              <div class="setting-item">
                <label for="provider">Provider:</label>
                <select id="provider">
                  <option value="openai">OpenAI (GPT)</option>
                  <option value="anthropic">Anthropic (Claude)</option>
                  <option value="gemini">Google Gemini</option>
                  <option value="cohere">Cohere</option>
                  <option value="huggingface">Hugging Face</option>
                  <option value="local">Local Models</option>
                  <option value="openrouter">OpenRouter (Multiple Models)</option>
                  <option value="custom">Custom API</option>
                </select>
                <button type="button" id="refreshProviders" class="btn-secondary btn-small" title="Refresh provider list">
                  üîÑ
                </button>
              </div>

              <div class="setting-item" id="providerInfo">
                <div class="provider-info-card">
                  <div class="provider-info-header">
                    <span class="provider-icon">ü§ñ</span>
                    <span class="provider-name">OpenAI</span>
                    <span class="provider-status" id="providerStatus">
                      <span class="status-dot status-unknown"></span>
                      <span class="status-text">Not tested</span>
                    </span>
                  </div>
                  <div class="provider-info-content">
                    <p id="providerDescription">OpenAI provides state-of-the-art language models including GPT-3.5 and GPT-4.</p>
                    <div class="provider-features" id="providerFeatures">
                      <span class="feature-tag">Fast Response</span>
                      <span class="feature-tag">High Quality</span>
                      <span class="feature-tag">Reliable</span>
                    </div>
                    <div class="provider-actions">
                      <button type="button" id="testProvider" class="btn-secondary btn-small">
                        Test Connection
                      </button>
                      <button type="button" id="getModels" class="btn-secondary btn-small">
                        Load Models
                      </button>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Dynamic provider configuration section -->
              <div id="providerConfigSection" class="provider-config-section" style="display: none;">
                <h4>Provider Configuration</h4>
                <div id="providerConfigFields" class="provider-config-fields">
                  <!-- Dynamic fields will be inserted here -->
                </div>
              </div>
            </section>

            <section class="settings-section">
              <h3>Authentication</h3>
              <div class="setting-item">
                <label for="apiKey">API Key:</label>
                <input
                  type="password"
                  id="apiKey"
                  placeholder="Enter your API key"
                />
                <button type="button" id="toggleApiKey" class="btn-secondary">
                  Show
                </button>
                <p class="setting-description">
                  Your API key will be stored securely in browser storage
                </p>
              </div>

              <div class="setting-item" id="quickLoginSection" style="display: none;">
                <label>Quick Authentication:</label>
                <div class="quick-login-container">
                  <button type="button" id="quickLogin" class="btn-primary">
                    <span class="login-icon">üîê</span>
                    Login with OpenRouter
                  </button>
                  <button type="button" id="getApiKey" class="btn-secondary">
                    <span class="key-icon">üîë</span>
                    Get API Key
                  </button>
                </div>
                <p class="setting-description">
                  Use OAuth to authenticate quickly, or get an API key for manual setup
                </p>
              </div>
            </section>

            <section class="settings-section">
              <h3>API Configuration</h3>
              <div class="setting-item" id="apiEndpointGroup">
                <label for="apiEndpoint">API Endpoint:</label>
                <input
                  type="url"
                  id="apiEndpoint"
                  placeholder="https://api.openai.com/v1/chat/completions"
                />
                <p class="setting-description">
                  API endpoint URL (for custom providers)
                </p>
              </div>

              <div class="setting-item">
                <label for="model">Model:</label>
                <div class="model-selection-container">
                  <select id="model">
                    <option value="gpt-3.5-turbo">GPT-3.5 Turbo</option>
                  </select>
                  <button type="button" id="refreshModels" class="btn-secondary btn-small" title="Refresh model list">
                    üîÑ
                  </button>
                </div>
                <div id="modelInfo" class="model-info" style="display: none;">
                  <div class="model-details">
                    <span id="modelName" class="model-name"></span>
                    <span id="modelDescription" class="model-description"></span>
                    <div id="modelSpecs" class="model-specs">
                      <span id="modelTokens" class="model-spec"></span>
                      <span id="modelCost" class="model-spec"></span>
                    </div>
                  </div>
                </div>
                <p class="setting-description">Select the AI model to use for text optimization</p>
              </div>
            </section>

            <section class="settings-section">
              <h3>Actions</h3>
              <div class="actions">
                <button type="button" id="testApi" class="btn-secondary">
                  Test API Connection
                </button>
              </div>
            </section>
          </div>

          <!-- Template Management Section -->
          <div class="content-section" id="templates-section">
            <div class="section-header">
              <h2>Template Management</h2>
              <p>Create, edit, and organize your prompt templates</p>
            </div>

            <section class="settings-section">
              <h3>Template Settings</h3>
              <div class="setting-item">
                <label class="toggle-label">
                  <input type="checkbox" id="quickTemplateSelection" checked>
                  <span class="toggle-slider"></span>
                  Enable quick template selection
                </label>
                <p class="setting-description">Show template selector when triggering optimization</p>
              </div>

              <div class="setting-item">
                <label for="selectedTemplate">Default template:</label>
                <select id="selectedTemplate">
                  <option value="general">General Improvement</option>
                </select>
                <p class="setting-description">Template to use when quick selection is disabled</p>
              </div>
            </section>

            <section class="settings-section">
              <h3>Template Library</h3>
              <div class="template-management">
                <div class="template-controls">
                  <div class="template-actions">
                    <button type="button" id="createTemplate" class="btn-primary">Create New Template</button>
                    <button type="button" id="importTemplates" class="btn-secondary">Import Templates</button>
                    <button type="button" id="exportTemplates" class="btn-secondary">Export Templates</button>
                  </div>

                  <div class="template-filters">
                    <input type="text" id="templateSearch" placeholder="Search templates..." class="search-input">
                    <select id="templateCategoryFilter" class="filter-select">
                      <option value="all">All Categories</option>
                      <option value="General">General</option>
                      <option value="Business">Business</option>
                      <option value="Creative">Creative</option>
                      <option value="Technical">Technical</option>
                      <option value="Editing">Editing</option>
                      <option value="Custom">Custom</option>
                    </select>
                  </div>
                </div>

                <div id="templateList" class="template-list">
                  <!-- Templates will be loaded here -->
                </div>

                <!-- Template Pagination -->
                <div class="pagination-container" id="templatePagination">
                  <div class="pagination-info">
                    <span id="templatePaginationInfo">Showing 1-10 of 25 templates</span>
                    <select id="templateItemsPerPage" class="items-per-page">
                      <option value="10">10 per page</option>
                      <option value="25">25 per page</option>
                      <option value="50">50 per page</option>
                    </select>
                  </div>

                  <div class="pagination-controls">
                    <button class="pagination-btn" id="templateFirstPage" disabled>First</button>
                    <button class="pagination-btn" id="templatePrevPage" disabled>Previous</button>
                    <div class="pagination-pages" id="templatePages">
                      <!-- Page numbers will be generated here -->
                    </div>
                    <button class="pagination-btn" id="templateNextPage">Next</button>
                    <button class="pagination-btn" id="templateLastPage">Last</button>
                  </div>

                  <div class="pagination-goto">
                    <label for="templateGotoPage">Go to page:</label>
                    <input type="number" id="templateGotoPage" min="1" class="goto-input">
                    <button class="btn-secondary btn-small" id="templateGotoBtn">Go</button>
                  </div>
                </div>
              </div>
            </section>

            <section class="settings-section">
              <h3>Legacy Prompt Template</h3>
              <div class="setting-item">
                <label for="promptTemplate">Fallback prompt template:</label>
                <textarea
                  id="promptTemplate"
                  rows="4"
                  placeholder="Please improve and optimize the following text while maintaining its original meaning and tone:

{text}"
                ></textarea>
                <p class="setting-description">
                  Use {text} as placeholder for the selected text. This is used when no template is selected.
                </p>
              </div>
            </section>
          </div>

          <!-- History Management Section -->
          <div class="content-section" id="history-section">
            <div class="section-header">
              <h2>Optimization History</h2>
              <p>View and manage your optimization history and usage statistics</p>
            </div>

            <section class="settings-section">
              <h3>Usage Statistics</h3>
              <div class="setting-item">
                <div class="history-stats" id="historyStats">
                  <div class="stat-item">
                    <span class="stat-label">Total Optimizations:</span>
                    <span class="stat-value" id="totalOptimizations">0</span>
                  </div>
                  <div class="stat-item">
                    <span class="stat-label">This Week:</span>
                    <span class="stat-value" id="weekOptimizations">0</span>
                  </div>
                  <div class="stat-item">
                    <span class="stat-label">Most Used Template:</span>
                    <span class="stat-value" id="mostUsedTemplate">-</span>
                  </div>
                </div>
              </div>
            </section>

            <section class="settings-section">
              <h3>History Management</h3>
              <div class="history-controls">
                <div class="history-filters">
                  <input type="text" id="historySearchInput" placeholder="Search history..." class="search-input">
                  <select id="historyTemplateFilter" class="filter-select">
                    <option value="all">All Templates</option>
                  </select>
                  <select id="historyDateFilter" class="filter-select">
                    <option value="all">All Time</option>
                    <option value="today">Today</option>
                    <option value="week">This Week</option>
                    <option value="month">This Month</option>
                  </select>
                </div>
              </div>

              <!-- History Pagination -->
              <div class="pagination-container" id="historyPagination">
                <div class="pagination-info">
                  <span id="historyPaginationInfo">Showing 1-25 of 150 items</span>
                  <select id="historyItemsPerPage" class="items-per-page">
                    <option value="10">10 per page</option>
                    <option value="25" selected>25 per page</option>
                    <option value="50">50 per page</option>
                  </select>
                </div>

                <div class="pagination-controls">
                  <button class="pagination-btn" id="historyFirstPage" disabled>First</button>
                  <button class="pagination-btn" id="historyPrevPage" disabled>Previous</button>
                  <div class="pagination-pages" id="historyPages">
                    <!-- Page numbers will be generated here -->
                  </div>
                  <button class="pagination-btn" id="historyNextPage">Next</button>
                  <button class="pagination-btn" id="historyLastPage">Last</button>
                </div>

                <div class="pagination-goto">
                  <label for="historyGotoPage">Go to page:</label>
                  <input type="number" id="historyGotoPage" min="1" class="goto-input">
                  <button class="btn-secondary btn-small" id="historyGotoBtn">Go</button>
                </div>
              </div>

              <div class="actions">
                <button type="button" id="viewHistory" class="btn-primary">View History</button>
                <button type="button" id="exportHistory" class="btn-secondary">Export History</button>
                <button type="button" id="clearHistory" class="btn-danger">Clear History</button>
              </div>
            </section>
          </div>

          <!-- Backup & Restore Section -->
          <div class="content-section" id="backup-section">
            <div class="section-header">
              <h2>Backup & Restore</h2>
              <p>Export and import your settings, templates, and configuration</p>
            </div>

            <section class="settings-section">
              <h3>Settings Backup</h3>
              <div class="actions">
                <button type="button" id="exportSettings" class="btn-secondary">
                  Export Settings
                </button>
                <input
                  type="file"
                  id="importFile"
                  accept=".json"
                  style="display: none"
                />
                <button type="button" id="importSettings" class="btn-secondary">
                  Import Settings
                </button>
              </div>
            </section>

            <section class="settings-section">
              <h3>Global Actions</h3>
              <div class="actions">
                <button type="button" id="saveSettings" class="btn-primary">
                  Save All Settings
                </button>
                <button type="button" id="resetSettings" class="btn-danger">
                  Reset to Defaults
                </button>
              </div>

              <div id="status" class="status-message"></div>
            </section>
          </div>

          <!-- Fixed Footer -->
          <footer class="main-footer">
            <div class="footer-content">
              <span>PromptBoost v1.0.0 - AI-powered text optimization</span>
              <div class="footer-actions">
                <button type="button" id="saveAllSettings" class="btn-primary btn-small">Save All</button>
                <span class="footer-status" id="footerStatus">All changes saved</span>
              </div>
            </div>
          </footer>
        </main>
      </div>
    </div>

    <!-- Template Creation Modal -->
    <div id="templateModal" class="template-modal" style="display: none;">
      <div class="template-modal-content">
        <div class="template-modal-header">
          <h3 id="modalTitle">Create New Template</h3>
          <button type="button" id="closeModal" class="btn-close">√ó</button>
        </div>

        <div class="template-modal-body">
          <div class="setting-item">
            <label for="templateName">Template Name:</label>
            <input type="text" id="templateName" placeholder="Enter template name">
          </div>

          <div class="setting-item">
            <label for="templateCategory">Category:</label>
            <select id="templateCategory">
              <option value="General">General</option>
              <option value="Business">Business</option>
              <option value="Creative">Creative</option>
              <option value="Technical">Technical</option>
              <option value="Editing">Editing</option>
              <option value="Custom">Custom</option>
            </select>
          </div>

          <div class="setting-item">
            <label for="templateDescription">Description:</label>
            <input type="text" id="templateDescription" placeholder="Brief description of what this template does">
          </div>

          <div class="setting-item">
            <label for="templatePrompt">Prompt Template:</label>
            <div id="templateEditorContainer" class="template-editor-wrapper">
              <!-- Enhanced template editor will be initialized here -->
            </div>
            <textarea id="templatePrompt" rows="6" placeholder="Enter your prompt template. Use {text} as placeholder for the selected text." style="display: none;"></textarea>
          </div>
        </div>

        <div class="template-modal-footer">
          <button type="button" id="saveTemplate" class="btn-primary">Save Template</button>
          <button type="button" id="cancelTemplate" class="btn-secondary">Cancel</button>
        </div>
      </div>
    </div>

    <!-- History Viewer Modal -->
    <div id="historyModal" class="template-modal" style="display: none;">
      <div class="template-modal-content" style="max-width: 900px;">
        <div class="template-modal-header">
          <h3>Optimization History</h3>
          <button type="button" id="closeHistoryModal" class="btn-close">√ó</button>
        </div>

        <div class="template-modal-body">
          <div class="history-filters">
            <input type="text" id="historySearch" placeholder="Search history..." style="margin-bottom: 1rem;">
            <select id="historyFilter" style="margin-bottom: 1rem;">
              <option value="all">All Templates</option>
            </select>
          </div>

          <div id="historyList" class="history-list">
            <!-- History items will be loaded here -->
          </div>
        </div>

        <div class="template-modal-footer">
          <button type="button" id="closeHistoryModalBtn" class="btn-secondary">Close</button>
        </div>
      </div>
    </div>

    <input type="file" id="templateImportFile" accept=".json" style="display: none;">

    <!-- Utilities and Services -->
    <script src="../utils/ErrorHandler.js"></script>
    <script src="../utils/Logger.js"></script>
    <script src="../utils/ConfigValidator.js"></script>
    <script src="../utils/ApiHelper.js"></script>
    <script src="../services/TemplateManager.js"></script>
    <script src="../services/ConfigurationManager.js"></script>

    <!-- Enhanced Template System -->
    <script src="../lib/codemirror-integration.js"></script>
    <script src="../templates/TemplateValidator.js"></script>
    <script src="../templates/TemplateEditor.js"></script>
    <script src="../templates/TemplateVersioning.js"></script>
    <script src="../templates/TemplateTester.js"></script>
    <link rel="stylesheet" href="../templates/template-editor.css">

    <script src="options.js"></script>
  </body>
</html>
